## 第一天
没看

## 第二天
概念:...  
功能:
1. 数据通信
2. 资源共享
3. 分布式处理
    + 可靠性
    + 负载均衡

现阶段: 多层次ISP结构

## 第三天
C/S  
P2P(peer to peer)  

## 第四天

### 标准化工作
+ RFC (Request For Commnets) ==> 因特网标准的形式
    - Internet Draft 这个阶段不是RFC文档(发邮件给rfc-editor@rfc-editor.org)
    - Proposed Standard 如果编辑同意了,那么从这个开始成为RFC文档
    - Draft Standard 网上大家对 Proposed Standard 讨论完善,形成草案标准, IETF,IAB 进行审核
    - Internet Standard 形成

### 相关组织
+ ISO(国际标准化组织)
    - OSI模型
    - HDLC协议
+ ITU(国际电信联盟)
    - 制定通信规则
+ IEEE(电气和电子工程师协会)
    + 学术机构
    + IEEE802系列标准
    + 5G
+ IETF(Internet工程任务组)
    + 负责恩特网相关标准的制定
    + RFC xxxx

### 性能指标
+ 速率
  + 就是 b/s kb/s Mb/s Gb/s Tb/s (不是大写的B)(这里是1000进制)
+ 带宽(高速公路的宽度啦)
  + 就是网络设备所支持的最高速度(100M的路由器,上限是12.5MB/s)(一秒发出几个数据)
+ 吞吐量
  + 通过某个口子的数据量, b/s , kb/s , Mb/s 等等
+ 时延
  + 数据(报文/分组/比特流)从一端传送到另一端的时间,单位s
  + 发送时延(传输时延)(第一比特发出开始到最后一比特发出完毕) `发送时延 = 数据长度 ÷ 信道带宽` (信道带宽就是发送速率啦,其实发送速率比带宽小的)
  + 传播时延(电磁波在链路(就是信道)中传播时间)
  + 排队时延(在网络设备缓存中的时间,因为路由器之类很忙)
  + 处理时延(数据校验之类)
  + `时延带宽积 = 传播时延 × 带宽` (就是信道中正在跑的数据)
+ 往返时延RTT
  + 从发送方发送开始,到收到接收方的确认,用的时间
  + `RTT = 传播时延×2+末端处理时间`
+ 利用率
  + `信道利用率 = 有数据通过时间 ÷ 总时间`
  + `网络利用率 = 信道利用率加权平均值`

# 第五天
## 分层结构
> 首先说明为什么要分层,比如两个计算机之间发送文件,在发送真正的文件之前,要对信道激活,要告诉网络如何识别目的主机,接收目的主机的回应,意外应对等等,如果把这些工作放到一起会很乱,所以分层,把不同对任务,交给不同的层来做
+ 实体:每一层对应要处理的数据
+ 协议:每一层约定的处理数据的方法
  + 语法:规定传输数据的格式
  + 语义:规定所要完成的功能
  + 同步:规定各种操作的顺序
+ 接口(访问服务点SAP):上层使用下层服务的入口
+ 服务:下层为相邻上层提供的功能调用(通过接口啦)

## 模型

### 7层OSI(开放系统互连)参考模型
|     层     |                                          描述                                          |                                                功能                                                |                协议                 |
| :--------: | :------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------: | :---------------------------------: |
|   应用层   |                           所有能和用户交互产生网络流量的程序                           |                                                                                                    | 文件传输FTP 电子邮件SMTP 万维网HTTP |
|   表示层   |                 用于处理在两个通信系统中交换信息的表示方式(语法和语义)                 |                              数据格式变换,数据加密解密,数据压缩和恢复                              |
|   会话层   |         向表示层实体/用户进程提供建立连接并在连接上有序地传输数据,就是建立同步         |     建立/管理/终止会话,使用校验点可使会话在通信失效时从校验点/同步点继续恢复通信,实现数据同步      |              ADSP,ASP               |
|   传输层   |          负责主机中两个进程的通信,即端到端的通信,传输单位是报文段或用户数据报          |                           可靠传输,不可靠传输,差错控制,流量控制,复用分用                           |               TCP,UDP               |
|   网络层   | 把分组从源端传到目的端,为分组交换网上的不同主机提供通信服务,单位是数据报(Σ分组=数据报) |                                路由选择,流量控制,差错控制,拥塞控制                                 |   IP,IPX,ICMP,IGMP,ARP,RARP,OSPF    |
| 数据链路层 |                主要任务是把网络层传下来的数据报组装成帧,所以单位就是帧                 |            成帧(定义帧的开始和结束),差错控制,流量控制,访问(接入)控制(控制对信道的访问)             |          SDLC,HDLC,PPP,STP          |
|   物理层   |           把数据变成光电信号发出去,在物理媒体上实现比特流的透明传输,单位比特           | 定义接口特性(就是真实的水晶头和接口),定义传输模式(单工,半双工,双工),定义传输速率,比特同步,比特编码 |             Rj45,802.3              |

### 5层体系结构
|     层     |
| :--------: |
|   应用层   |
|   传输层   |
|   网际层   |
| 数据链路层 |
| 网络接口层 |
### 4层TCP/IP参考模型
|     层     |           协议           |
| :--------: | :----------------------: |
|   应用层   |       HTTP,FTP,DNS       |
|   传输层   |         TCP,UDP          |
|   网际层   |            IP            |
| 网络接口层 | Ethernet,ATM,Frame Relay |

# 第六天
## 吧啦吧啦一堆,目前重要的是信道
  + 信道
    > 信号的传输媒介.一般用来表示向某一个方向传送信息的偶读,因此一条通信线路往往包含一条发送信道和一条接收信道
## 通信方式
+ 单工通信
  > 只有一个方向的通信而没有反方向的交互,仅需要一条信道
+ 半双工通信
  > 通信的双方都可以发送或接收信息,但任何一方都不能同时发送和接收,需要两条信道
+ 全双工通信
  > 通信双方可以同时发送和接受信息,也需要两信道

## 传输方式
+ 串行传输
  > 速度慢,费用低,适合远距离
+ 并行传输
  > 速度快,费用高,适合近距离,用于计算机内部数据传输

# 第七天
## 码元
> 指用一个固定时长的信号波形(数字脉冲),代表不同离散数值的基本波形,是数字通信中数字信号的计量单位,这个时长内的信号称为k进制码元,而该时长称为码元宽度,当码元的离散状态有M个时(M大于2),此时码元为M进制码元.  
> 一个码元可以携带多个比特的信息量.例如,在使用二进制编码时,只有两种不同的码元,一种代表0状态,另一种代表1状态.

## 速率
> 也叫数据率,是指数据的传输速率,表示单位时间内传输的数据量.可以用码元传输速率和信息传输速率表示.  
1. **码元传输速率**:别名码元速率,波形速率,调制速率,符号速率等,它表示单位时间内数字通信系统所传输的码元个数(也可称为脉冲个数或信号变化的次数),单位是波特(Baud).1波特表示数字通信系统每秒传输一个码元.这里的码元可以是多进制的,也可以是二进制的,但码元速率与进制数无关.
2. **信息传输速率**:别名信息速率,比特率等,表示单位时间内数字通信系统传输的**二进制码元**个数(即比特数),单位是比特/秒(b/s)
3. **带宽**:表示在单位时间内从网络中的某一点到另一点所能通过的"最高数据率",常用来表示网络的通信线路所能传输数据的能力.单位是b/s

# 第八天
## 失真
1. 码间串扰
   > 接收端收到的信号波形失去了码元之间清晰界限的现象
1. 信道带宽
   > 信道能通过的最高频率和最低频率之差
## 奈氏准则（奈奎斯特定理）
> 在理想低通(无噪声,带宽受限)条件下,为了避免码间串扰,极限码元传输速率为2W Baud, W是信道带宽,单位是Hz.  
> 理想低通信通下的极限数据传输率为 **$2Wlog{_2}V$** 单位(b/s).*V为码元的离散电平数目,所以说白了 $log{_2}V$就是一个码元表示几位比特*
1. 在任何信道中,码元传输的速率是有上限的.若传输速率超过此上限,就会出现严重的码间串扰问题,使接收端对码元的完全正确识别成为不可能.
2. 信道的**频带越宽**(即能通过的信号高频分量越多),就可以用更高的速率进行码元的有效传输.
3. 奈氏准则给出了码元传输速率的限制,但并没有对信息传输速率给出限制.
4. 由于码元的传输速率受奈氏准则的制约,所以要提高数据的传输速率,就必须设法使每个码元能携带更多个比特的信息量,这就需要采用多元制的调制方法.

## 香农定理
> 在**带宽受限**且**有噪声**的信道中,为了不产生误差,信息的数据传输速率有上限值.
1. 信噪比 = 信号的平均功率(S)/噪声的平均功率(N),记为$S/N$,常用分贝(dB)为单位,转换公式为:
   > 信噪比(dB) = $10lg{(S/N)}$
2. 信道的极限数据传输速率
   > $Wlog{_2}{(1+S/N)}$  
   > W为带宽(Hz)
   > 1. 信道的带宽或信道中的信噪比越大,则信息的极限传输速率就越高
   > 1. 对一定的传输带宽和一定信噪比,信息传输速率的上限就确定了
   > 1. 只要信息的传输速率低于信道的极限传输速率,就一定能找到某种方法来实现**无差错的传输**
   > 1. 香农定理得出的为极限信息传输速率,实际信道能达到的传输速率要比它低不少
   > 1. 从香农定理可以看出,若信道带宽W或信噪比S/N没有上限(不可能),那么信道的极限信息传输速率也就没有上限

# 第九天
## 基带信号
> 将数字信号1和0直接用两种不同的电压表示,再送到数字信道上去传输(基带传输).  
> 来自信源的信号,像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号.基带信号就是发出的直接表达了要传输的信息的信号,比如我们说话的声波就是基带信号.
## 宽带信号
> 将基带信号进行调制后形成的频分复用模拟信号,再传送到模拟信道上去传输(宽带传输)  
> 把基带信号经过载波调制后,把信号的频率范围搬移到较高的频段以便在信道中传输(即在一段频率范围内能够通过信道).

在传输距离较近时,计算机网络采用基带传输方式(近距离衰减小,从而信号内容不易发生变化)  
在传输距离较远时,计算机网络采用宽带传输方式(远距离衰减大,即使信号变化大也能最后过滤出来基带信号)

## 编码
> 数据 --> 数字信号
## 调制
> 数据 --> 模拟信号

## 数字数据编码为数字信号
1. 非归零编码(NRZ)
   > 高1低0  
   > 编码容易实现,但没有检错功能,且无法判断一个码元的开始和结束,以至于收发双方难以保持同步.
2. 曼彻斯特编码
   > 将一个码元分成两个相等的间隔,前一个间隔为低电平,后一个间隔为高电平表示1,而0就是电平反过来.当然也可以采用相反的规定.
   > 该编码的特点是在每一个码元的中间出现电平跳变,位于中间的跳变即作时钟信号(可用于同步),又作数据信号,但它所占的频带宽度是原始的基带宽度的两倍.  
   > 每一个码元都被调成两个电平,所以数据传输速率只有调制速率的1/2
3. 差分曼彻斯特编码
   > 同1异0  
   > 常用于局域网传输,其规则是:若码元为1,则前半个码元的电平与上一个码元的后半个码元的电平相同,若为0,则相反.  
   > 该编码的特点是,在每个码元的中间,都有一次电平的跳转,可以实现自同步,且抗干扰性强于曼彻斯特编码.
4. 归零编码(RZ)
   > 信号电平在一个码元之内都要恢复到零的一种编码方式
5. 反向不归零编码(NRZI)
   > 信号电平翻转表示0,信号电平不变表示1
6. 4B/5B编码
   > 比特流中插入额外的比特以打破一连串的0或1,就是用5个比特来编码4个比特的数据,之后再传给接收方,因此称为4B/5B.编码效率为80%.  
   > 只采用16种对应16种不同的4位码,其他16种作为控制码(帧的开始和结束,线路的状态信息等)或保留.

![数字数据编码为数字信号](assets/Screenshot%202021-11-20%20192538.png)
![数字数据编码为数字信号](assets/Screenshot%202021-11-20%20193330.png)
![数字数据编码为数字信号](assets/Screenshot%202021-11-20%20193700.png)

# 第十天
## 数字数据调制为模拟信号
> 数字数据调制技术在发送端将数字信号转换为模拟信号,而在接收端将模拟信号还原为数字信号,分别对应于调制解调器的调制和解调过程
1. ASK(调幅)
2. FSK(调频)
3. PSK(调相)

![调制](assets/Screenshot%202021-11-20%20205018.png)

4. QAM(正交振幅调制) 调幅加调相

## 模拟数据编码为数字信号
> 计算机内部处理的是二进制数据,处理的都是数字音频,所以需要将模拟音频通过采样,量化转换成有限个数字表示的离散序列(即实现音频数字化)  
> 最典型的例子就是对音频信号进行编码的脉码调制(PCM),在计算机应用中,能够达到最高保真水平的就是PCM编码,被广泛用于素材保存及音乐欣赏,CD,DVD以及我们常见的WAV文件中均有应用.它主要包括三步,抽样,量化,编码.
> 1. 抽样  
> 对模拟信号周期性扫描,把时间上连续的信号变成时间上离散的信号.  
> 为了使用所得的离散信号能无失真地代表被抽样的模拟数据,要使用采样定理进行采样:$f{_采样频率} ≥ 2f{_信号最高频率}$(原理就是,任何波都可以转成一系列正弦波的叠加,对其中最高频率的正弦波进行采样,一个周期内,采两个点**除了与x轴的交点**就知道这个正弦波的波形了,因为一个周期内,采了两次,所以就有了这个公式)
> 1. 量化  
> 把抽样取得的电平幅值按照一定的分级标度转化为对应的数字值,并取整数,这就把连续的电平幅值转换为离散的数字量.
> 1. 编码  
> 把量化的结果转换为与之对应的二进制编码.

## 模拟数据调制为模拟信号
> 为了实现传输的有效性,可能需要较高的频率.这种调制方式还可以使用频分复用技术,充分利用带宽资源.在电话机和本地交换机所传输的信号是采用模拟信号传输模拟数据的方式.模拟声音数据是加载到模拟的载波信号中传输的.

# 第十一天
## 传输介质
> 传输介质也称传输媒体/传输媒介,它就是数据传输系统中发送设备和接收设备之间的物理通路  
> 传输媒体并不是物理层.  
> 传输媒体在物理层的下面,因为物理层是体系结构的第一层,因此有时称传输媒体为第0层.  
> 在传输媒体中传输的是信号,是传输媒体并不知道所传输的信号代表什么意思.  
> 但物理层规定了电气特性,因此能够识别传送的比特流.

## 双绞线
> 之所以"绞",是为了减少相邻导线的电磁干扰

## 同轴电缆
> 50Ω的同轴电缆一般用于基带数字信号传送  
> 75Ω的用于传送宽带信号,就是"闭路线"

## 光纤
> 光纤通信就是利用光导纤维传递光脉冲来进行通信.有光脉冲表示1,无光脉冲表示0.而可见光的频率大约是10E8MHz,因此光纤通信系统的带宽远远大于目前其他各种传输媒体的带宽.  
> 光纤在发送端有光源,可以采用发光二极管或半异体激光器,它产在电脉冲作用下能产生出光脉冲,在接收端用光电二极管做成光检测器,在检测到光脉冲时可还原出电脉冲.

|          |                            定义                             |           光源           |         特点          |                           外观                           |
| :------: | :---------------------------------------------------------: | :----------------------: | :-------------------: | :------------------------------------------------------: |
| 单模光纤 | 一种在横向模式直接传输光信号的光纤,光纤直径基本就是光的波长 | 定向性很好的激光二极管理 | 衰耗小,适合远距离传输 | ![单模光纤](assets/Screenshot%202021-11-21%20142737.png) |
| 多模光纤 |                 有多种传输光信号模式的光纤                  |        发光二极管        | 易失真,适合近距离传输 | ![多模光纤](assets/Screenshot%202021-11-21%20142757.png) |

## 无线电波
> 信号向所有方向传播  
> 较强穿透能力,可传远距离,广泛用于通信领域(如手机通信)
## 微波
> 信号固定方向传播  
> 频率较高,频段范围宽,因此数据率很高  
> 地面微波接力通信  
> 卫星通信
## 红外线,激光
> 信号固定方向传播  
> 把要传输的信号分别转换为各自的信号格式,即红外光信号和激光信号,再在空间中传播

# 第十二天
## 中继器
> 诞生原因:由于存在损耗,在线路上传输的信号功率会逐渐衰减,衰减到一定程度时将造成信号失真,因此会导致接收错误.  
> 功能:对信号进行再生和还原,对衰减的信号进行放大,保持与原数据相同,以增加信号传输的距离,延长网络的长度.**再生数字信号**  
> 中继器的两端:两端的网络部分是网段,而不是子网,适用于完全相同的两类网络的互连,且两网段速率要相同.中继器只将任何电缆段上的数据发送到另一段电缆上,它仅作用于信号的电气部分,并不管数据中是否有错误数据或不适于网段的数据  
> 两端可连相同媒体,也不连不同媒体  
> 中继器两端的网段一定要是同一个协议,所以它不会存储转发 ~~(我现在还真不知道什么叫存储转发)~~  
> **5-4-3规则**:网络标准中都对信号的延迟范围作了具体的规定,因而中继器只能在规定的范围内进行,否则会网络故障.
> 5个网段,4个中继器或其他东东,只有3个网段可以挂接计算机  

## 集线器(多口中继器)
> **功能:** 对信号进行再生放大转发,对衰减的信号进行放大,接着转发到其他所有(除输入端口外)处于工作状态的端口上,以增加信号传输的距离,延长网络的长度.不具备信号的定向传送能力,是一个共享式设备.(集线器不能分割冲突域)

---
---

# 第三章 数据链路层

**结点**:主机,路由器

**链路**:网络中两个结点之间的物理通道,链路的传输介质主要有双绞线,光纤和微波.分为有线链路和无线链路.

**数据链路**:网络中两个结点之间的逻辑通道,把实现控制数据传输协议的硬件和软件加到链路上就构成数据链路.

**帧**:链路层的协议数据单元,封装网络层数据报.

## 数据链路层
> 负责通过一条链路从一个结点向另一个物理链路直接相连的相邻结点传送数据报.  
> 在物理层提供服务的基础上向网络层提供服务,其最基本的服务是将源自网络层来的数据可靠地传输到相邻节点的目标机网络层.  
> 其主要作用是加强物理层传输原始比特流的功能,将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路,使这对网络层表现为一条无差错的链路.
### 功能
1. 为网络层提供服务
   + 无确认无连接服务
   + 有确认无连接服务
   + 有确认面向连接服务
1. 链路管理,主要用于面向连接的服务
   + 建立
   + 维持
   + 释放
1. 组帧
1. 流量控制,限制发送方的速度
1. 差错控制(帧错/位错)

## 封装成帧
> 封装成帧就是在一段数据的前后部分添加首部和尾部,这样就构成了一个帧.接收端在收到物理层上交的比特流后,就能根据首部和尾部的标记,从收到的比特流中识别帧的开始和结束.  

## 帧同步
> 接收方应当能从接收到的二进制比特流中区分出帧的起始和终止


## 透明传输
> 指不管所传数据是什么样的比特组合,都应当能够在链路上传送.因此,链路层就"看不见"有什么妨碍数据传输的东西.  
> 当所传数据中的比特组合恰巧与某一个控制信息完全一样时,就必须采取适当的措施,使收方不会将这样的数据误认为是某种控制信息.这样才能保证数据链路层的传输是透明的.

## 组帧的四种方法:
> 1. 字符计数法
> 帧首部使用一个计数字段(第一个字节,八位)来标帧内字符数.
> ![字符计数法](assets/Screenshot%202021-11-27%20194036.png)
> 只要一个帧首部出问题,那就全乱了
> 1. 字符(节)填充法
> ![字符(节)填充法](assets/Screenshot%202021-11-27%20194917.png)
> SOH (start of header)  
> EOT (end of transmission)
> ESC (escape)
> 1. 零比特填充法
> ![零比特填充法](assets/Screenshot%202021-11-27%20195631.png)
> 在数据部分5个连续的1出现时,就在后边加上一个0  
> 5 "1" 1 "0"  
> 这就保证数据部分不会出现6个连续的1
> 1. 违规编码法
> ![违规编码法](assets/Screenshot%202021-11-27%20200030.png)

由于字节计数法中Count字段的脆弱性(其值若有差错将导致灾难性后果)及字符填充实现上的复杂性和不兼容性,目前较普遍使用的帧同步法是比特填充和违规编码法

## 差错来源
1. 全局性
   > 由于线路本身电气特性所产生的随机噪声(热噪声),是信道固有的,随机存在的.  
   > 解决办法:提高信噪比来减少或避免干扰(对传感器下手)
1. 局部性
   > 外界特定的短暂原因所造成的冲击噪声,是产生差错的主要原因  
   解决办法:通常利用编码技术来解决

## 差错  
1. 位错:比特位出错,1=>0,0=>1
2. 帧错:
   + 丢失
   + 重复
   + 失序

## 差错控制
1. 检错编码
   + 奇偶校验码
     > 就是n-1位信息元,加上1位校验元  
     > 使整个码字中1的个数的奇数或者偶数  
     > 只能检查出奇数个比特错误,检错能力为50%
   + 循环冗余码CRC
     > 方法到是不复杂,但是原理,为是什么要用异或我不明白,等之后深入了解二进制运算再说  
     > 过程自己google吧  
     > CRC一般用硬件检测,速度飞快  
     > 基本上可以认为,通过CRC检测的就是无差错的帧
2. 纠错编码
   + 海明码: 发现双比特错,纠正单比特错
     > 海明不等式 $2^r ≥ k+r+1$ (r为冗余信息位,k为信息位)  
     > 还是那句话,过程不复杂,但是原理为什么,真不知道

## 数据链路层的数量控制
> 是点到点的控制,当接收方收不下就不回复确认
方法:
1. 停止-等待协议
   > 每发送完一个帧就停止发送,等待对方的确认,在收到确认后再发送下一个帧.  
   > 1. 数据帧丢失或检测到帧出错,接收方可以不返回确认帧,让发送方,超时重传.注意这里,发完一个帧,要保留他的副本,数据帧和确认帧要编号
   > 1. ACK(确认帧)丢失,还是超时重传,接收方丢弃重复帧,返回确认帧
   > 1. ACK迟到,接收方和发送方都丢弃重复帧
2. 滑动窗口协议
   1. 后退N帧协议(GBN)
      + 上层的调用
         > 上层要发送数据时,发送方先检查发送窗口是否已满,如果未满,则产生一个帧并将其发送,如果窗口已满,发送方只需将数据返回给上层,暗示上层窗口已满.上层等一会再发送.(实际实现中,发送方可以缓存这些数据,窗口不满时再发送帧)
      + 收到了一个ACK
         > GBN协议中,对n号帧的确认采用**累积确认**的方式,标明接收方已经收到n号帧和它之前的全部帧
      + 超时事件
         > 协议的名字为`后退N帧/回退N帧`,来源于出现丢失和时延过长时发送主的行为.就像在停等协议中一样,定时器将再次用于恢复数据帧或确认帧的丢失.如果出现超时,发送方重传所有已发送但未被确认的帧.
      + 接收方
         + 如果正确收到n号帧,并且按序,那么接收方为n帧发送一个ACK,并将该帧中的数据部分交付给上层.
         + 其余情况,收到错乱的帧后,丢弃之,并发送一个正确的ACK帧号.接收方无需缓存任何失序帧,只需要维护一个信息:expectedSeqNum(下一个按序接收的帧序号)
      + 注意
         > 若采用n个比特对帧编号,那么发送窗口的最大尺寸为 $2^n-1$
      + 其他
        + 优点:因连续发送数据帧而提高了信道利用率
        + 缺点:在重传时必须把原来已经正确传送的数据帧重传,使传送效率降低
   2. 选择重传协议(SR)
      + 上层的调用
         > 从上层收到数据后,SR发送方检查下一个可用于该帧的序号,如果序号位于发送窗口内,则发送数据帧;否则就像GBN一样,要么将数据缓存,要么返回给上层之后再传输
      + 收到了一个ACK
         > 如果收到ACK,加入该帧序号在窗口内,则SR发送方将那个被确认的帧标记为接收.如果该帧序号是窗口的下界(最左边第一个窗口对应的序号),则窗口向前移动到具有最小序号的未确认帧处.如果窗口移动了并且有序号在窗口的未发送帧,则发送这些帧.
      + 超时事件
         > 每个帧都有自己的定时器,一个超时事件发生后只重传一个帧
      + 接收方
         > SR接收方将确认一个正确接收的帧而不管其是否按序.失序的帧将被缓存,并返回给发送方一个该帧的确认帧,真到所有帧(就是和之前的帧连上号的)皆被收到为止,这时才可以将一批按序交付给上层,然后向前移动滑动窗口.如果收到窗口序号外(小于窗口下界)的帧,就返回一个ACK
      + 窗口大小
         > 一般发送窗口等于接收窗口,最大为$2^{n-1}$
## 信道利用率
> 发送方在一个发送周期内,有效地发送数据所需要的时间占整个发送周期的比率.  
> $信道吞吐率=信道利用率×发送方的发送速率$  
> $信道利用率=L÷(C×T)$  
> T为发送周期(从开始发送数据,到收到第一个确认帧为止)  
> C为发送方数据传输率
> L的发送的比特数

## 传输数据使用的两种链路
+ 点对点链路
  > 两个相邻节点通过一个链路相连,没有第三都.比如,PPP协议,常用于广域网
+ 广播式链路
  > 所有主机共享通信介质.比如,早期的总线以太网,无线局域网,常用于局域网

## 介质访问控制
> 采用一定的措施,使得两对节点之间的通信不会发生互相干扰的情况
+ 静态划分信道
  + 信道划分介质访问控制
    > 将使用介质的每个设备与来自同一信道上的其他设备的通信隔离开,把时域和频域资源合理地分配给网络上的设备.
    + 多路复用技术
      > 把多个信号组合在一条物理信道上进行传输,使得多个计算机或终端设备共享信道资源,提高信道利用率.
      + 频分多路复用FDM
         > 用户在分配到一定的频带后,在通信过程中自始至终占用这个频带.频分利用的所有用户在同样的时间占用不同的带宽(频率带宽)资源
      + 时分多路复用TDM
         > 将时间划分为一段段等长的时分复用帧(TDM帧).每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙,所有用户轮流占用信道.  
         > TDM帧是在物理层传送的比特流所划分的帧,标志一个周期
      + 统计时分复用STDM
         > 在TDM的基础上,加上一个集中器,用缓存的方式,来减少空闭时间,提高利用率
      + 波分多路复用WDM
         > 即`光的频分多路复用`,在一根光纤中传输多种不同波长(频率)的光信号,由于波长(频率)不同,所以各路光信号互不干扰,最后再用波长分解复用器各路波长分解出来.
      + 码分多路复用CDM
        + 码分多址(CDMA)是码分复用的一种方式(就是正交向量,正交向量和,之后再把和向量在正交向量上取投影,取单位向量啊,1就是1,-1就是0,0就是没有)
          > 1个比特分为多个码片/芯片(chip),每一个站点被指定一个唯一的m位的芯片序列.  
          > 发送1时站点发送芯片序列,发送0时发送芯片序列反码(通常把0写成-1).  
          > 如何不干扰:多个站点同时发送数据的时候,要求各个站点芯片序列相互正交.  
          > 如何合并:各路数据在信道中被线性相加.  
          > 如何分离:合并的数据和源站规格化内种.

+ 动态分配信道
  + 轮询访问介质访问控制
    + 轮询协议
      > 主结点轮流"询问"从属结点来发送数据
    + 令牌传递协议
      > 令牌:一个特殊格式的控制帧,不含任何信息.控制信道的使用,确保同一时刻只有一个结点独占信道.  
      > 每个结点都可以在一定的时间内(令牌持有时间)获得发送数据的权利,并不是无限制地持有令牌  

  + 随机访问介质访问控制
    + ALOHA协议
      > 不监听信道,不按时间槽发送,随机重发  
      > 如果发生冲突,接收方会检测出差错,然后不予确认,发送方在一定时间内收不到确认帧,就会触发超时,那么会在一个随机的时间后,再重传
    + 时隙ALOHA协议
      > 把时间分成若干个相同的时间片,所有用户在时间片开始时刻同步接入网络信道,若发生冲突,则必须等到下一个时间片开始时刻再发送
    + CSMA协议
      > 全称 carrier sense multiple access  
      > 载波监听多路访问协议  
      > 每一个站在发送数据之前要检测一下总线上是否有其他计算机在发送数据  
      > 当几个站同时在总线上发送数据时,总线上的信号电压摆动值将会增大(互相叠加),当一个站检测到的信号电压摆值超过一定阈值时,就认为总线上至少有两个站同时在发送数据,表明产生了碰撞,即发生了冲突.  
      + 1-坚持CSMA:如果一个主机要发送消息,那么它先监听信道.空闲则直接传输,不必等待.忙则一直监听,直到空闲马上传输.如果有冲突(一段时间内未收到肯定回复),则等待一个随机长的时间再监听,重复上述过程.
      + 非坚持CSMA:如果一个主机要发送消息,那么它先监听信道.空闲则直接传输,不必等待.忙则等待一个随机的时间之后再进行监听.
      + p-坚持CSMA:如果一个主机要发送消息,那么它先监听信道.空闲则以p概率直接传输,不必等待;概率1-p等待到下一个时间槽再传输.忙则等待一个随机的时间之后再进行监听.
    + CSMA/CD协议(总线型网络)
      > 全称 carrier sense multiple access with collision detection  
      > 中文名"载波监听多点接入/碰撞检测"  
      > 在发送数据前和发送数据时都检测总线上是否有其他计算机在发送数据,如果发生冲突,就停止发送数据(半双工网络)
      + 截断二进制指数规避算法
        > 确定基本退避(推迟)时间为2τ,其中τ为信号从一端到另一端的传播时延  
        > 定义参数k,它等于重传次数,但k不超过10,即$k=min(重传次数,10)$.当重传次数不超过10时,k等于重传次数;当重传次数大于10时,k就不再增大而一直等于10.  
        > 从离散的整数集合$[0,1,..,2^k-1]$中随机取出一个数r,重传所需退避的时间就是r倍的基本退避时间,即2rτ.  
        > 当重传达16次仍不能成功时,说明网络太拥挤,认为此帧永远无法正确发出,抛弃此帧并向高层报告出错
      + $最小帧长≥2τ×数据发送输率$
      + 补充
        > 以太网规定最短帧长为64B,凡是长度小于60B的都是由于冲突而异常终止的无效帧
    + CSMA/CA协议(可用于无线局域网)
      > 全称 carrier sense multiple access with collision avoidance  
      > 中文 载波监听多点接入/碰撞避免  
      > 发送数据前,先检测信道是否空闲  
      > 空闲则发出RTS(request to send),RTS包括发射端的地址,接收端的地址,下一份数据将持续发送的时间等信息;信道忙则等待.  
      > 接收端收到RTS后,将响应CTS(clear to send)  
      > 发送端收到CTS后,开始发送数据帧(同时预约信道:发送方告知其他站点自己要传多久数据)  
      > 接收端收到数据帧后,将用CRC来检验数据是否正确,正确则响应ACK帧.
      > 发送方收到ACK就可以进行下一个数据帧的发送,若没有则一直重传至规定重发次数为止(采用二进制指数退避算法来确定随机的推迟时间)

## 局域网
> Local Area Network 简称LAN,是指在某一区域内由多台计算机互联成的计算机组,使用广播信道.
### 特点
1. 覆盖的地理范围较小,只在一个相对独立的局部范围内联,如一座或集中的建筑群内.
2. 使用专门铺设的传输介质(双绞线,同轴电缆)进行联网,数据传输速率高(10Mb/s~10Gb/s).
3. 通信延迟时间短,误码率低,可靠性较高.
4. 各站为平等关系,共享传输信道.
5. 多采用分布式控制和广播通信,能进行广播和组播
### 拓扑结构
1. 星型
2. 总线型
3. 环形
4. 树型
### 介质访问控制方法
1. CSMA/CD
2. 令牌总线
3. 令牌环
### 分类
1. 以太网
   > 以太网是应用最为广泛的局域网,包括标准以太网(10Mbps),快速以太网(100Mbps),千兆以太网(1000Mbps)和10G以太网,它们都符合IEEE802.3系列标准规范.逻辑拓扑总线型,物理拓扑是星形或拓展星型.使用CSMA/CD.
2. 令牌环网
   > 物理上采用了星形拓扑结构,逻辑上是环形拓扑结构.已过时.
3. FDDI网(Fiber Distributed Data Interface 光纤分布式数据接口)
   > 物理上采用双环拓扑结构,逻辑上是环形拓扑结构.
4. ATM网(Asynchronous Transfer Mode 异步传输模型)
   > 较新型的单元交换技术,使用53字节固定长度的单元进行交换.
5. 无线局域网(Wireless Local Area Network;WLAN)
   > 采用IEEE802.11标准
### IEEE802标准
> IEEE802系列标准是IEEE802 LAN/MAN 标准委员会制定的局域网,城域网技术标准(1980年2月成立).其中最广泛使用的有以太网,令牌环,无线局域网等.这一系列标准中的每一个子标准都由委员会中的一个专门工作组负责.

### MAC子层和LLC子层
> IEEE 802 标准所描述的局域网参考模型只对应OSI参考模型的数据链路层和物理层,它将数据链路层划分为逻辑链路层LLC子层和介质访问控制MAC子层.
+ LLC子层
  > 负责识别网络层协议,然后对它们进行封装.LLC报头告诉数据链路层一旦帧被接收到时,应当对数据包做何处理.  
  > 为网络层提供服务:无确认无连接,面向连接,带确认无连接,高速传送
+ MAC子层
  > 负责数据帧的封装/卸装,帧的寻址和识别,帧的接收与发送,链路的管理,帧的差错控制等.  
  > MAC子层的存在屏蔽了不同物理链路种类的差异性.

## 以太网
> Ethernet 是由Xerox 公司创建并由Xerox,Intel和DEC公司联合开发的基带总线局域网规范,是当今现有局域网采用的最通用的通信协议标准.以太网使用CSMA/CD技术.  
> 只实现无差错接收,不实现可靠传输
+ 无连接:发送方和接收方之间无"握手过程".
+ 不可靠:不对发送方的数据帧编号,接收方不向发送方进行确认,差错帧直接丢弃,差错纠正由高层负责.
### 拓扑
> 目前为逻辑上总线型,物理上星型,就是用上了集线器.
### 10BASE-T以太网
> 10BASE-T是传送基带信号的双绞线以太网,T表示采用双绞线,现10BASE-T采用的是无屏蔽双绞线(UTP),传输速率是10Mb/s.
+ 物理上采用星型拓扑,逻辑上总线型,第段双绞线最长为100m.
+ 采用曼彻斯特编码.
+ 采用CSMA/CD介质访问控制
### 适配器和MAC地址
+ 适配器就是网卡,它居然有处理器和存储器(包括RAM和ROM)
+ ROM上有计算机硬件地址MAC地址
+ MAC地址:每个适配器有一个全球唯一的48位二进制地址,前24位代表厂家(由IEEE规定),后24厂家自己指定.常用6个十六进制表示.
### 以太网MAC帧
最常用的MAC帧是以太网V2的格式:
![以太网MAC帧](assets/Screenshot%202021-12-11%20195609.png)

### 高速以太网
速率大于100Mb/s的以太网
1. 100BASE-T以太网
   > 在双绞线上传送100Mb/s基带信号的星形拓扑以太网,仍使用IEEE802.3的CSMA/CD协议  
   > 支持全双工和半双工,可在全双工方式下工作而无冲突.(使用交换机,隔离冲突域)
2. 吉比特以太网
   > 在光纤或双绞线上传送1Gb/s信号  
   > 支持全双工或半双工,可在全双工方式下工作而无冲突
3. 10吉比特
   > 10吉比特以太网在光纤上传送10Gb/s信号  
   > 只支持全双工,无争用问题

## 无线局域网
### 802.11的MAC帧头格式
![802.11的MAC帧头格式](assets/Screenshot%202021-12-12%20102528.png)
> 个人明说:这里的无线局域网,可比wifi大多了,可以理解成基站和手机的关系,手机和基站通过无线信号连接,而基站组通过网络连接...

## 广域网
> Wide Area Network,WAN.通常跨接很大的物理范围,所覆盖的范围从几十公里到几千公理,它能连接多个城市或国家,或横跨几个洲并提供元距离通信,形成国际性的远程网络.  
> 广域网的通信子网主要使用分组交换技术.广域网的通信子网可以利用公用分组交换网,卫星通信网和无线分组交换网,它将分布在不同地区的局域网或计算机系统互连起来,达到资源共享的目的.如Internet是世界上范围最大的广域网.
### PPP协议
> 点对点协议(Point-to-Point Protocol)是目前使用最广泛的数据链路层协议,用户使用拨号电话接入因特网时一般都使用PPP协议.只支持全双工链路.
1. 要求
   + 简单:对于链路层的帧,无需纠错,无需序号,无需流量控制.
   + 封装成帧:帧定界符
   + 透明传输:与帧定界符一样的比特组合的数据处理方式:异步线路用字节填充,同步线路用比特填充
   + 多种网络层协议:封装的IP数据报可以采用多种协议
   + 多种类型链路:串行/并行,同步/异步,电/光...
   + 差错检测:错就德育
   + 检测连接状态:链路是否正常工作
   + 最大传送单元:数据部分最大长度MTU
   + 网络层地址协商:知道通信双方的网络层地坛
   + 数据压缩协商
2. 不要求
   + 纠错
   + 流量控制
   + 序号
   + 不支持多点线路
3. 三个组成部分
   + 一个将IP数据报封装到串行链路(同步串行/异步串行)的方法
   + 链路控制协议LCP:建立并维护数据链路连接
   + 网络控制协议NCP:PPP可支持多种网络层协议,每个不同的网络层协议都要一个相应的NCP来配置,为网络层协议建立和配置逻辑连接
4. 状态图
   ![状态图](assets/Screenshot%202021-12-12%20132526.png)
5. 帧格式
   ![帧格式](assets/Screenshot%202021-12-12%20151901.png)

### HDLC协议
> 高级数据链路控制(High-Level Data Link Control),是一个在同步网上传输数据,面向比特的数据链路层协议,它是由国际标准化组织(ISO)根据IBM公司的SDLC(SynchronousData Link Control)协议扩展开发而成的.  
> 数据报文可透明传输,用于实现透明传输的"0比特插入法"易于硬件实现  
> 个人说明:视频里说的稀烂,不知道她在说什么,之后我自己再Google吧.

## 网桥
> 根据MAC帧的目的地址对帧进行转发和过滤.当网桥收到一个帧时,并不向所有接口转发此帧,而是先检查此帧的目的MAC地址,然后再确定将该帧转发到哪一个接口,或者是把它丢弃(即过滤).
![网桥](assets/Screenshot%202021-12-12%20161825.png)
## 以太网交换机
> 中以理解成多端口网桥
+ 直通式交换机
  > 查完目的地址就立刻转发.  
  > 延迟小,可靠性低,无法支持具有不同速率的端口的交换
+ 存储转发式交换机
  > 将帧放入高速缓存,并检查是否正确,正确则转发,错误则丢弃.
  > 延迟大,可靠性高,可以支持具有不同速率的端口的交换

## 冲突域
> 在同一个冲突域中的每一个节点都能收到所有被发送的帧.  
> 简单的说就是同一时间内只能有一台设备发送信息的范围.

## 广播域
> 网络中能接收任一设备发出的广播帧的所有设备的集合.  
> 简单的说如果站点发出一个广播信号,所有能接收收到这个信号的设备范围称为一个广播域.

|                           | 能否隔离冲突域 | 能否隔离广播域 |
| :-----------------------: | :------------: | :------------: |
| 物理层设备(中继器,集线器) |       ❌        |       ❌        |
|  链路层设备(网桥,交换机)  |       ✔️        |       ❌        |
|    网络层设备(路由器)     |       ✔️        |       ✔️        |

# 网络层
> 把分组从源端传到目的端,为分组交换网上的不同主机提供通信服务.网络层传输单位是数据报.(把数据报分割成分组)
## 功能
+ 路由选择与分组转发
+ 异构网络互联
+ 拥塞控制
  > 若所有结点都来不及接受分组,而要丢弃大量分组的话,网络就处于拥塞状态.因此要采用一定措施,缓解这种拥塞.如,开环控制和闭环控制

## 电路交换
> 比如,电话网络  
> 特点:独占资源
+ 优点:通信时延小,有序传输,没有冲突,实时性强
+ 缺点:建立连接时间长,线路独占,使用效率低,灵活性差,无差错控制能力

## 报文交换
> 报文是源应用发送的信息整件
+ 优点:无需建立连接,存储转发,动态分配线路,线路可靠性较高,线路利用率较高,多目标服务
+ 缺点:有存储转发时延,报文大小不定,需要网络节点有较大缓存空间

## 分组交换
> 把大的数据块分割成小的数据块
+ 优点:无需建立连接,存储转发,动态分配线路,线路可靠性较高,线路利用率较高,相对于报文交换,存储管理更容易
+ 缺点:有存储转发时延,需要传输额外的信息量,乱序到目的主机时,要对分组排序重组
1. 数据报方式
   > 为网络层提供无连接服务,就是不事先为分组的传输确定传输路径,每个分组独立确定传输路径,不同分组传输路径可能不同.
   + 无连接
   + 每个分组携带源和目的地址
   + 路由器根据分组的目的地址转发分组:基于路由协议/算法构建转发表;检索转发表;每个分组独立选路
2. 虚电路方式
   > 就是一条源主机到目的主机类似于电路的路径(逻辑连接),路径上所有结点都要维持这条虚电路的建立,都维持一张虚电路表,每一项记录了一个打开的虚电路的信息.  
   > 为网络层提供连接服务,就是首先为分组传输确定传输路径(建立连接),然后沿该路径(连接)传输系列分组,系列分组传输路径相同,传输结束后拆除连接.  
   > 虚电路将数据报方式和电路交换方式结合,以发挥两者优点.  
   > 说白了,就是用网络中的路由器,虚拟出一个电路连接,就是源主机发送"呼叫请求"分组,等收分"呼叫应答"分组后就是建立了连接,数据传输为全双工通信,分组要携带"虚电路号"来说明走的路由,通信完成后,源主机发送"释放请求"分组,来拆除虚电路.

## 对比
|                    |                        数据报服务                        |                       虚电路服务                        |
| :----------------: | :------------------------------------------------------: | :-----------------------------------------------------: |
|     连接的建立     |                           不要                           |                         必须有                          |
|      目的地址      |                每个分组都有完整的目的地址                | 仅在建立连接阶段使用,之后每个分组使用长度较短的虚电路号 |
|      路由选择      |             每个分组独立地进行路由选择和转发             |          属于同一条虚电路的分组按照同一路转发           |
|      分组顺序      |                   不保证分组的有序到达                   |                   保证分组的有序到达                    |
|       可靠性       |          不保证可靠通信,可靠性由用户主机来保证           |                    可靠性由网络保证                     |
| 对网络故障的适应性 | 出故障的结点丢失分组,其他分组路径选择发生变化,可正常传输 |         所有经过故障结点的虚电路均不能正常工作          |
| 差错处理和流量控制 |       由用户主机进行流量控制,不保证数据报的可靠性        |          可由分组交换网负责,也可由用户主机负责          |

## 几种传输单元名词

|            |               |
| :--------: | :-----------: |
|   应用层   |     报文      |
|   传输层   |    报文段     |
|   网络层   | IP数据报,分组 |
| 数据链路层 |      帧       |
|   物理层   |    比特流     |

## TCP/IP 协议栈
![TCP/IP 协议栈](assets/Screenshot%202021-12-18%20104858.png)

## IP数据报格式
![IP数据报格式](assets/Screenshot%202021-12-18%20105339.png)
![IP数据报格式](assets/Screenshot%202021-12-18%20110604.png)

## IP数据报分片
> 回顾一个数据链路层的最大传送单元MTU,以太网的MTU是1500Bytes,所以如果IP分组超过这个上限,就要分片.  
> 上图中  
> + 标识:同一数据的分片使用同一标识
> + 标志:只有2个位是有意义的 × _ _ ,中间位DF(Don't Fragment) DF=1 禁止分片,DF=0 允许分片,最低位MF(More Fragment) MF=1 后面还有分片,MF=0 最后一片或没有分片
> + 片偏移:指出较长分组分片后,某片在原分组中的相对位置.以8B为单位.所以除了最后一个分片,每个分片长度一定是8B的整数倍.

## 分类的IP地址
> IP地址:全世界唯一的32位/4字节标识符,标识路由器主机的**接口**  
> 用点分十进制(192.168.1.1)表示,表示{<网络号>,<主机号>}  
> ![分类](assets/Screenshot%202021-12-18%20202454.png)  
> ![特殊IP地址](assets/Screenshot%202021-12-18%20204317.png)  
> ![总结](assets/Screenshot%202021-12-18%20205021.png)
## 私有IP地址
> 网络路由器不认这些地址,不转发  
> ![私有IP地址](assets/Screenshot%202021-12-18%20204447.png)  

## 网络地址转换NAT
> Network Address Translation(NAT): 在专用网连接到因特网的路由器上安装NAT软件,安装了NAT软件的路由器叫NAT路由器,它至少有一个有效的外部全球IP地址.  
> 在NAT路由器中有一个转换表,使用端口号做区分,大概如下图  
> ![](assets/Screenshot%202021-12-18%20221519.png)

## 子网划分
> 由两级IP{<网络号>,<主机号>},变成三级IP{<网络号>,<子网号>,<主机号>}

## 子网掩码
> 不管对两级IP还是三级IP,子网掩码的<主机号>就是0,其他是1,与IP地址作与运算,目的就是拿到<网络号>[,<子网号>]

## 路由器转发分组的算法
1. 提取目的的IP地址
2. 是否直接交付
3. 特定主机路由
4. 检测路由表中有无路径
5. 默认路由0.0.0.0
6. 丢弃,报告转发分组出错

## 无分类编址CIDR
> 消除了传统的A类,B类,C类等地址以及划分子网的概念.  
> 而是使用{<网络前缀>,<主机号>}的方式来表示  
> 在IP地址后加上"/",然后写上网络前缀(可以任意长度)的位数,如,128.14.32.0/10  
> 融合子网发地址和子网掩码,方便子网划分,CIDR把网络前缀都相同的连续的IP地址组成一个"CIDR地址块".(用最小地址加外位数来表示地址块)  
> 地址掩码(子网掩码)就是位数个1,之后是0  

## 构成超网
> 将多个子网聚合成一个较大的子网,叫做构成超网,或路由聚合.  
> 方法:
> + 将网络前缀缩短:把多个小子网合成一个大网
> + 最长前缀匹配:使用CIDR时,查找路由表可能得到多个匹配结果,应选择具有最长网络前缀的路由.前缀越长,地址块越小,路由越具体.

## ARP协议
由于在实际网络的链路上传送数据帧时,最终必须使用MAC地址.  
所以,ARP协议完成了主机或路由器IP地址到MAC地址的映射.  
大概过程就是:  
如果在同一个局域网内,ARP表里没有缓存IP=>MAC,那么广播一个{<源IP><目的IP><源MAC><全1的MAC>},当目的机收到之后,返回一个{<目的IP><目的MAC>}给源主机.  
如果给另一个局域网发数据(可以用子网掩码判断),就是网关发个{<源IP><网关IP><源MAC><全1的MAC>},之后网关返回{<网关IP><网关MAC>}.之后,源主机发送{<数据><源IP><目的IP><源MAC><网关MAC>}给网关,网关拿到数据后,基本就是重复上面步骤.  
**ARP协议使用过程**
> 检查ARP高速缓存,有对应表项则写入MAC帧,没有则用目的MAC地址为FF-FF-FF-FF-FF-FF的帧封装并广播ARP请求分组,同一局域网中所有主机都能收到该请求.目的主机收到请求后就会向源主机单播一个ARP响应分组,源主机到后将此映射写入ARP缓存(10到20分钟更新一次).  

4种典型情况:
1. 主机A发给本网络上的主机B:用ARP找到主机B的硬件地址.
2. 主机A发给另一网络上的主机B:用ARP找到本网络上一个路由器(网关)的硬件地址.
3. 路由器发给本网络的主机A:用ARP找到主机A的硬件地址.
4. 路由器发给另一个网络的主机B:用ARP找到本网络上的一个路由器的硬件地址.

**ARP协议是自动进行的,对主机是透明的**

## DHCP协议
> 动态主机配置协议DHCP是应用层协议,使用客户/服务器方式,客户端和服务端通过广播方式进行交互,基于UDP.  
> DHCP提供即插即用联网的机制,主机可以从服务器动态获取IP地址,子网掩码,默认网关,DNS服务器名称,允许地址重用,支持移动用户加入网络,支持在用地址续租.  

当主机加入一个网络后 
1. 主机广播DHCP发现报文
   > "有没有DHCP服务器呀?"  
   > 试图找到网络中的服务器
2. DHCP服务器广播DHCP提供报文
   > "有"  
   > 服务器拟分配给主机一个IP地址及相关配置,先到先得.
3. 主机广播DHCP请求报文
   > "我用你给我的IP地址啦?"  
   > 主机向服务器请求提供IP地址.
4. DHCP服务器广播DHCP确认报文
   > "给你IP地址"  
   > 正式将IP地址分配给主机.

## 网际控制报文协议ICMP
![ICMP](assets/Screenshot%202021-12-19%20223312.png)
+ ICMP差错报告报文
  1. 终点不可达:当路由器或主机不能交付数据报时就向源点发送终点不可达报文.
  2. ~~源点抑制:当路由器或主机由于拥塞而丢弃数据报时,就向源点发送源点抑制报文,使用源点知道应当报数据报的发送速率放慢.~~
  3. 时间超过:当路由器收到生存时间TTL=0的数据报时,除丢弃该数据报外,还要向源点发送时间超过报文.当终点在预先规定的时间内不能收到一个数据报的全部数据报片时,就把已收到的数据报片都丢弃,并向源点发送时间超过报文.
  4. 参数问题:当路由器或目的主机收到的数据报的首部中有字段的值不正确时,就丢弃该数据报,并向源点发送参数问题报文.
  5. 改变路由(重定向):路由器把改变路由报文发送给主机,让主机知道下次应将数据报发送给另外的路由器(可通过更好的路由).

## ICMP差错报告报文数据字段
![ICMP差错报告报文数据字段](assets/Screenshot%202021-12-19%20224527.png)

## 不应发送ICMP差错报文的情况
1. 对ICMP差错报告报文不再发送ICMP差错报告报文
2. 对第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报告报文.
3. 对具有组播地址的数据报都不发送ICMP差错报告报文
4. 对具有特殊地址(如127.0.0.0或0.0.0.0)的数据报不发送ICMP差错报告报文.

## ICMP询问报文
1. 回送请求和回答报文:主机或路由器向特定目的主机发出的询问,收到此报文的主机必须给源主机或路由器发送ICMP回答报文.测试目的站是否可达以及了解其相关状态.
2. 时间戳请求和回答报文:请某个主机或路由器回答当前的日期和时间.用来进行时钟同步和测量时间.
3. ~~掩码地址请求和回答报文~~
4. ~~路由器询问和通告报文~~

## ICMP的应用
+ PING
  > 测试两个主机之间的连通性,使用了ICMP回送请求和回答报文
+ Traceroute
  > 跟踪一个分组从源点到终点的路径,使用了ICMP时间超过差错报告报文,就是发送一系列TTL为1,2,3,4,5...的数据报.

## IPv6
![IPv6数据格式](assets/Screenshot%202021-12-20%20202451.png)
![IPv6数据格式](assets/Screenshot%202021-12-20%20203130.png)

## IPv6与IPv4对比
1. IPv6将地址从32位(4B)扩大到128位(16B),更大的地址空间
2. IPv6将IPv4的校验和字段彻底移除,以减少每跳的处理时间
3. IPv6将IPv4的可选字段移出首部,变成了扩展首部,成为灵活的首部格式,路由器通常不对扩展首部进行检查,大大提高了路由器的处理效率.
4. IPv6支持即插即用(即自动配置),不需要DHCP协议.
5. IPv6首部长度必须是8B的整数倍,IPv4首部是4B的整数倍.
6. IPv6只能在主机处分片,IPv4可以在路由器和主机处分片.
7. ICMPv6:附加报文类型"分组过大".
8. IPv6支持资源的预分配,支持实时视像等要求,保证一定的带宽和时延的应用.
9. IPv6取消了协议字段,改成下一个首部字段
10. IPv6取消了总长度字段,改用有效载荷长度字段.
11. IPv6取消了服务类型字段.

## IPv6地址表示形式
+ 一般形式:冒号十六进制记法
  > 2001:0db8:0000:0000:0000:ff00:0042:8329
+ 压缩形式
  > 2001:db8:0:0:0:ff00:42:8329
+ 零压缩:一连串连续的0可以被一对冒号取代(双冒号表示法在一个地址中仅可出现一次)
  > 2001:db8::ff00:42:8329

## IPv6基本地址类型
+ 单播:一对一通信 可做源地址和目的地址
+ 多播:一对多通信 可做目的地址
+ 任播:一对多中的一个通信 可做目的地址

## IPv6向IPv4过渡的策略
+ 双栈协议
  > 指在一台设备上同时启用IPv4协议栈和IPv6协议栈.这样的话,这台设备既能和IPv4网络通信,又能和IPv6网络通信.如果这台设备是一个路由器,那么这台路由器的不同接口上,分别配置了IPv4地址和IPv6地址,并很可能分别连接了IPv4网络和IPv6网络.如果这台设备是一个计算机,那么它将同时拥有IPv4地址和IPv6地址,并具备同时处理这两个协议地址的功能.
+ 隧道技术
  > 通过使用互联网络的基础设施在网络之间传递数据的方式.使用隧道传递的数据(或负载)可以是不同协议的数据帧或包.隧道协议将其它的数据帧或包重新封装然后通过隧道发送.

## 路由表
![路由表](assets/Screenshot%202021-12-20%20212834.png)

## 路由算法
+ 静态路由算法(非自适应路由算法),管理员手工配置路由信息
  > 简便,可靠,在负荷稳定,拓扑变化不大的网络中运行效果很好,广泛用于高度安全的军事网络和较小的商业网络.但是路由更新慢,不适用大型网络.
+ 动态路由算法(自适应路由算法),路由器间彼此交换信息,按照路由算法优化出路由表项.
  > 路由更新快,适用大型网络,及时响应链路费用或网络拓扑变化.但算法复杂,增加网络负担.
  + 全局性:链路状态路由算法(OSPF),所有路由器掌握完整的网络拓扑和链路费用信息.
  + 分散性:距离向量路由算法(RIP),路由器只掌握物理相连的邻居及链路费用.

## 分层次的路由选择协议
由于**因特网规模很大**,而且许多单位不想让外界知道自己的路由选择协议,但还想连入因特网,就出现了自治系统的概念.  
**自治系统AS**:在单一的技术管理下的一组路由器,而这些路由器使用一种AS内部的路由选择协议和共同的度量以确定分组在该AS内的路由,同时还使用一种AS之间的路由协议以确定在AS之间的路由.一个AS内的所有网络都属于一个行政单位来管辖,一个自治系统的所有路由器在本自治系统内都必须连通.  
### **路由选择协议**
+ 内部网关协议IGP 一个AS内使用
  + RIP,OSPF
+ 外部网关协议EGP AS之间使用
  + BGP

## RIP协议(适用于小互联网)
> 是一种分布式的基于距离向量的路由选择协议,是因特网的协议标准,最大优点是简单.
> 要求网络中每一上路由器都维护从它自己到其他每一个目的网络的唯一最佳距离记录(即一组距离)
> ![](assets/Screenshot%202022-01-09%20120719.png)
> 其中距离,其实就是"跳数",即从源端口到目的端口所经过的路由器个数,经过一个路由器跳数+1.特别的,从一路由器到直接连接的网络距离为1.RIP允许路由最多只能包含15个路由器,因此距离为16表示网络不可达.

### 大概过程
1. 仅和相邻路由器交换信息.
2. 路由器交换的信息是自己的路由表
3. 每30秒交换一次路由信息,然后路由器根据新信息更新路由表.若超过180s没收到邻居路由器的通告,则判定邻居没了,并更新自己路由表.
> 路由器刚开始工作时,只知道直接连接的网络的距离,接着每一个路由器也只和数目非常有限的相信路由器交换更新路由信息.  
> 经过若干次更新后,所有路由器最终都知道到达本自治系统任何一个网络的最短距离和下一跳路由器的地址,即"收敛"

##距离向量算法
1. 修改相邻路由器发来的RIP报文中所有表项
   > 对地址为X的相邻路由器发来的RIP报文,修改此报文中的所有项目:把"下一跳"字段中的地址改为X,并把所有的"距离"字段+1.

![](assets/Screenshot%202022-01-09%20132420.png)

2. 对修改后的RIP报文中的每一个项目,进行以下步骤:
   1. R1路由表中若没有Net3,则把该项目填入R1路由表
   2. R1路由表中若有Net3,则查看下一跳路由器地址:
      1. 若下一跳是X,则用收到的项目替换源路由表中的项目
      2. 若下一跳不是X,原来距离比从X走的距离远则更新,否则不作处理.
3. 若180s还没收到相邻路由器X的更新路由表,则把X记为不可达的路由器,即把距离设置为16.
4. 重复以上步骤

## RIP协议报文格式
![](assets/Screenshot%202022-01-09%20143835.png)

## RIP的特点
+ 好消息传得快,坏消息传得慢
  > 当网络出现故障时,要经过比较长的时间(例如数分钟才)能将些信息传送到所有的路由器,"慢收敛".
  > 当一个网络不可达时,两个路由器可能会出现"踢皮球"的情况,从1跳,更新到2跳,再到3跳,一直到16跳,才知道网络不可达.

## OSPF协议
> 开放最短路径优先OSPF协议:"开放"标明OSPF协议不是受某一家厂商控制,而是公开发表的;"最短路径优先"是因为使用了Dijkstra提出的最短路径算法SPF.  
> OSPF最主要的特征就是使用分布式的链路状态协议.

## OSPF的特点
1. 使用洪泛法向自治系统内所有路由器发送信息,即路由器通过输出端口向所有相邻的路由器发送信息,而每一个相邻路由器又再次将此信息发往其所有的相邻路由器.最终整个区域内所有路由器都得到了这个信息的一个副本.
2. 发送的信息就是与本路由器相邻的所有路由器的链路状态(本路由器和哪些路由器相邻,以及该链路的度量/代价--费用,距离,时延,带宽等).
3. 只有当链路状态发生变化时,路由器才向所有路由器洪泛发送此信息.

最后,所有路由器都能建立一个链路状态数据库,即全网拓扑图.

## 链路状态路由算法
1. 每个路由器发现它的邻居结点(通过HELLO问候分组),并了解邻居节点的网络地址.
2. 设置到它的每个邻居的成本度量metric.
3. 构造"DD数据库描述分组",向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息.
4. 如果DD分组中的摘要自己都有,则邻站不做处理;如果有没有的或者是更新的,则发送"LSR链路状态请求分组",请求自己没有的和比自己新的信息.
5. 收到邻站的LSR分组后,发送"LSU链路状态更新分组"进行更新.
6. 更新完毕后,邻站返回一个"LSAck链路状态确认分组"进行确认.
7. 使用Dijkstra根据自己的链路状态数据库构造到其他节点间的最短路径.

## OSPF的区域
为了使用OSPF能够用于规模很大的网络,OSPF将一个自治系统再划分为若干个更小的范围,叫做区域.每一个区域都有一个32位的区域标识符(用点分十进制表示).  
区域也不能太大,在一个区域内的路由器最好不超过200个.
![](assets/Screenshot%202022-01-09%20180336.png)

## OSPF分组
![](assets/Screenshot%202022-01-09%20181549.png)

## OSPF其他特点
1. 每隔30min,要刷新一次数据库中的链路状态.
2. 由于一个路由器的链路状态只涉及到与相邻路由器的连通状态,因而与整个互联网的规模并无直接关系.因此当互联网规模很大时,OSPF协议要比距离向量协议RIP好得多.
3. OSPF不存在坏消息传的慢的问题,它的收敛速度很快.

